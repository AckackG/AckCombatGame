# 塔防游戏

# 更新计划

**quadtree 是用来筛选“附近单位”的，碰撞检测只是其中之一的用法。实际上还是距离函数在发挥作用**

## 功能更新

### GUI 更新
- [x] 炫酷的主界面
- [x] 暂停功能
- [x] 滚轮缩放视角，重置视角
- [x] 右键移动视角
- [ ] 战役模式：完善刷怪波数，让游戏能玩起来
- [x] 数据展示：展示枪械数据
- [ ] 系统设置：，暂时将地图大小参数加入此页面。保存到 localstorage 的 key config :{map_size}里 ，每次打开游戏后优先读取localstorage，否则用默认值。使用玩家自定义设置时，主菜单的本按钮变为 系统设置（已修改）

### 游戏逻辑

- [x] 把 entities 改成 WORLD class + GAME class , OOP 化
  - [x] 全局统一一个 performance.now()，循环更新，需要的直接取。先看看是不是每一帧都会有 perf now
  - [x] 分离entity 和 bullet 的数组，quadtree 再放到一起做判断。  
- [x] 优化 Quadtree 的逻辑，不需要计算 bullet To bullet 的碰撞。去官网看看鼠标VS方块的碰撞代码是什么，有没有判断方块间不碰撞的代码
- [x] 给单位加上粗线render,指示瞄准的方向，代表枪指着
- [x] 我军单位集中在左侧，敌军在右侧
- [x] 统一单位/子弹的移动逻辑，分为moveToXY和 moveAngle
- [x] 用圆和线段相交算法判定子弹击中，替换简单的距离算法，解决了高速子弹在一帧内穿过单位所以没有伤害的问题
- [x] 优化 NearestTargeting 逻辑，先选择 quadtree 里的，找到了就不用全图遍历了
- [x] Monster 重选目标，用 quadtree 筛选附近的目标，如果没有则跳过
- [x] 单把武器的数据统计，和全武器的统计放到一个函数里
- [ ] 把碰撞逻辑从gameloop 改成 unit update (为啥？有什么好处？)
- [ ] 优化 DEBUGINFO 的性能，DOM重排会极大的影响性能： CANVAS绘制 OR 重复利用 DOM
- [ ] Monster 分为近战和远程，毕竟AI不一样，吗？
- [ ] 能不能做斜着的方形？车辆
- [ ] 更新 quadtree2.0-ts，支持圆形、线段、方形

### 武器逻辑

- [x] 利用单位碰撞，实现"范围伤害"的逻辑。按照原碰撞逻辑，子弹周围的每个单位都会对他进行判断，
  - [x] 给子弹加一个 blkast_radius属性！width height 根据 radius 和 size 大的来! （pierce屏蔽） | 
  - [x] 近炸引信？伤害按照距离衰减。这下 explosion 特效真的有用了 | 
  - [x] 在子弹死亡时给一个bool: exploding ，临时加大 width height 供 quadtree 判断，然后在下一帧造成范围伤害
- [x] 武器数据统计功能，+击中的子弹数，【统计】准度，击杀数，击杀率，击杀时间
- [ ] 武器开火时，后坐力慢慢加到最大值
  - [ ] 简单版：在一半的弹匣处？
  - [ ] 复杂版：后坐力随着开火增加，随着时间衰减。新属性：recoil,recoil_max,recoil_increment,recoil_decay |喷子除外
- [ ] 子弹随着距离伤害衰减曲线
- [ ] 瞬间击中武器也用 bullet 逻辑，取消instaweapon?，bullet加参数 target,insta 。用于瞬间击中和追踪弹。有必要用同一个逻辑吗？还是分开两个比较好呢？
- [x] 子弹曳光属性，和曳光颜色。用多个alpha不同的粗细的直线模拟。参考平移指示线，
- [x] 合并 Entity 和 Human，改名为 Unit(战斗单位), Monster(近战单位), Fighter(玩家单位), Turret(固定单位)
- [x] 优化随机武器逻辑，读取数据后不用手动指定随机数。目的是加了武器和弹头就能用
  - [x] DEBUG菜单优化：读取每一把武器增加一个DEBUG按钮，刷出对应的士兵和敌对士兵
- [ ] hp -= damage 做成单独的函数，用于护甲和减伤

## 数据更新

### 我军

- [x] RPG、榴弹炮爆炸武器
- [x] 电磁炮，高弹速
- [ ] 跟踪导弹（子弹的新属性，homing）
- [ ] 闪电炮，瞬间弹射攻击
- [ ] 光束炮，高速贯穿直线 (模拟光束)
- [ ] 地震炮，原地AOE效果
- [ ] 医疗枪，瞄准队友加血Effect
- [ ] 引力炮，弧形飞到目的地，一半距离改变AX AY
  - [x] 对子弹的 dx dy 给一个随机的加速向量折腾一下
- [ ] 士兵升级，对武器操控性有加成（不能改武器伤害，不然太魔幻了）
- [ ] 长条建筑单位，用于挡子弹
- [ ] 车辆单位，是圆形，还是长方形？
  - [ ] 装甲车，高速机炮专打步兵
  - [ ] 坦克，高伤害穿甲弹，低射速

### 敌人

- [ ] 远程怪物，慢速子弹、远程攻击
- [ ] 分裂怪物,利用 ondeath。| 理论上来说，一个单位 dead=true，这一帧结束时就会被删除
- [ ] 产卵怪物，武器产生单位而不是子弹
- [x] dummy 用于当靶子
